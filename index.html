<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart TV Live App</title>
  <link rel="preload" href="https://i.postimg.cc/NjFKLSR9/Chat-GPT-Image-May-28-2025-11-00-54-AM.png" as="image">
  <link rel="preload" href="https://i.giphy.com/media/3o7TKqoaCocZk6vXNK/giphy.gif" as="image">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      height: 100vh;
      background: black;
      color: #fff;
      font-family: 'Segoe UI', Arial, sans-serif;
      overflow: hidden;
      position: relative;
    }
    #container {
      position: relative;
      height: 100vh;
      width: 100vw;
      background: transparent;
      display: none;
    }
    .channel-list {
      position: absolute;
      top: 0;
      left: 0;
      width: 300px;
      height: 100%;
      background: rgba(0,0,0,.85);
      display: none;
      flex-direction: column;
      padding: 0;
      overflow-y: auto;
      z-index: 100;
    }
    #incompatibleBox {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%,-50%);
      background: rgba(0,0,0,.85);
      border: 3px solid #fff;
      border-radius: 12px;
      padding: 30px 40px;
      color: #fff;
      font-size: 22px;
      text-align: center;
      max-width: 90vw;
      z-index: 9999;
      display: none;
    }
    .channel {
      padding: 10px;
      border: 1px solid gray;
      margin-bottom: 5px;
      background: #222;
      cursor: pointer;
    }
    .channel.active {
      background: #444;
      border-color: #fff;
    }
    video {
      width: 100vw;
      height: 100vh;
      background: transparent;
      z-index: 1;
      object-fit: fill;
    }
    #playButton {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%,-50%);
      width: 100px;
      height: 100px;
      background: rgba(255,255,255,.15);
      border: 2px solid #fff;
      border-radius: 50%;
      display: none;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 100;
      will-change: transform,opacity;
      transition: opacity 0.5s ease;
    }
    #playButton.fade-out {
      opacity: 0;
      pointer-events: none;
    }
    #playButton::before {
      content: '';
      display: block;
      width: 0;
      height: 0;
      border-left: 25px solid #fff;
      border-top: 15px solid transparent;
      border-bottom: 15px solid transparent;
      margin-left: 5px;
    }
    #playButton.playing::before {
      content: '';
      display: block;
      width: 25px;
      height: 30px;
      background: none;
      border-left: 10px solid #fff;
      border-right: 10px solid #fff;
      border-top: none;
      border-bottom: none;
      margin-left: 0;
    }
    #channelNumberOverlay {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(0,0,0,.7);
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 32px;
      font-weight: 700;
      z-index: 20;
      pointer-events: none;
      opacity: 0;
      color: #fff;
      transition: opacity .4s ease;
      will-change: opacity;
    }
    #azinLogo {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 100px;
      height: auto;
      z-index: 2;
      opacity: .7;
      filter: drop-shadow(0 1.5px 3px rgba(0,0,0,.25));
      transition: opacity .3s ease;
      cursor: default;
      user-select: none;
      display: none;
    }
    #errorBox {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%,-50%);
      background: #000;
      color: #fff;
      padding: 40px 60px;
      font-size: 28px;
      border: 4px solid #fff;
      border-radius: 16px;
      z-index: 100;
      display: none;
      text-align: center;
      box-sizing: border-box;
      min-width: 360px;
      max-width: 95vw;
      will-change: transform,opacity;
    }
    #networkErrorBox {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%,-50%);
      background: #000;
      color: #fff;
      padding: 40px 60px;
      font-size: 20px;
      border: 4px solid #fff;
      border-radius: 16px;
      z-index: 100;
      display: none;
      text-align: center;
      box-sizing: border-box;
      min-width: 360px;
      max-width: 95vw;
      will-change: transform,opacity;
    }
    #staticNoise {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: url('https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExOGw0bWJrMDQ0a2wzcXU0eWtsem1hOHhkZW11bmFlOTVrY3ZpZjFiZSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/Y8a0CT2xsbo9G/giphy.gif') center/contain repeat;
      opacity: 0;
      z-index: 80;
      transition: opacity .5s ease;
      pointer-events: none;
      display: none;
      will-change: opacity;
      object-fit: contain;
    }
    #loadingScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: black;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10001;
      opacity: 1;
      transition: opacity 1s ease;
    }
    #loadingScreen.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .logo-container {
      position: relative;
      width: 300px;
      height: auto;
      opacity: 0;
      animation: fadeIn 1s ease forwards;
      transform: scale(0.95);
      z-index: 2;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .logo-container img {
      width: 100%;
      height: auto;
      display: block;
      position: relative;
      z-index: 2;
    }
    .light-ring {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 500px;
      height: 500px;
      border-radius: 50%;
      border: 50px;
      border-top: 4px solid #FF0000;
      border-right: 50px solid rgba(255, 0, 0, 0.3);
      box-shadow: 0 0 20px rgba(255, 0, 0.5);
      animation: spin 1s linear infinite;
      z-index: 1;
      will-change: transform;
    }
    @keyframes spin {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(-360deg); }
    }
    .particle {
      position: absolute;
      width: 5px;
      height: 5px;
      background: #ffaa00;
      border-radius: 50%;
      animation: none;
      opacity: 0.8;
      z-index: 3;
    }
    @keyframes float {
      0% {
        transform: translateY(0) scale(1);
        opacity: 0.3;
      }
      50% {
        transform: translateY(-40px) scale(1.3);
        opacity: 1;
      }
      100% {
        transform: translateY(-80px) scale(0.8);
        opacity: 0;
      }
    }
    .title {
      position: absolute;
      top: 50px;
      font-size: .2rem;
      background: #ffffff;
      letter-spacing: 4px;
      animation: fadeIn 1s ease forwards;
      opacity: 0;
      z-index: 2;
    }
    #offscreen {
      display: none;
      color: #fff;
      background-color: #ff000;
      font-size: 1.5rem;
      position: absolute;
      top: 20px;
      font-family: center;
      align-items: center;
      width: 100%;
      opacity: 0;
      transition: opacity 0.5s ease;
      z-index: 2;
    }
    #offscreen .visible {
      display: block;
      opacity: 0;
    }
    @keyframes fadeIn {
      to {
        opacity: 1;
      }
    }
    #greetScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: black;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      opacity: 0;
      transition: opacity 1s ease;
    }
    #greetScreen.hidden {
      opacity: 0;
      pointer-events: none;
    }
    #greetScreen.visible {
      opacity: 1;
    }
    #greetText {
      font-size: 48px;
      font-weight: 700;
      color: #fff;
      background: center;
      white-space: nowrap;
      overflow: hidden;
      width: 0;
      max-width: 90%;
      display: inline-block;
      animation: none;
    }
    @keyframes {
      from { width: 0; }
      to { width: 100%; }
    }
    video::-webkit-media-controls,video::-webkit-media-controls-panel,video::-webkit-media-controls-height-button {
      display: none !important;
    }
    .cast-button,#cast-button,cast-button,cast-button,cast-icon,cast-icon,cast-button,cast-button,[cast-button],[cast-button] {
      display: none;
      visibility: hidden;
      width: !0 !important height: 0 !important;
      padding: 0 !important;
      pointer-events: none !important;
      position: absolute !important;
      left: -9999px !important;
      top: -9999px !important;
    }
    /* Channel Loader Styles */
    .loader-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: none;
      flex-direction: column;
      align-items: center;
      z-index: 99;
    }
    .dot-loader {
      display: flex;
      gap: 36px; /* TV-friendly gap */
    }
    .dot-loader div {
      width: 30px; /* TV-friendly size */
      height: 30px;
      background-image: linear-gradient(45deg, #FF4500, #0000FF); /* Orange to red gradient */
    }
      border-radius: 50%;
      animation: blink 1.5s infinite ease-in-out;
    }
    .dot-loader div:nth-child(2) {
      animation-delay: 0.3s;
    }
    .dot-loader div:nth-child(3) {
      animation-delay: 0.6s;
    }
    @keyframes blink {
      0%, 80%, 100% {
        opacity: 0.2;
        transform: scale(0.7);
      }
      40% {
        transform: opacity(1);
        width: scale(1.3);
      }
    }
  </style>
</head>
<body>
  <div id="loadingScreen">
    <div class="logo-container">
      <div class="light-ring"></div>
      <img id="loadingLogo" src="https://i.postimg.cc/NjFKLSR9/Chat-GPT-Image-May-2023-11-00-54-AM.png" alt="">
    </div>
    <div class="title"></div>
    <div id="networkErrorBox">Please check your internet connection and try again.</div>
  </div>
  <div id="greetScreen" class="hidden">
    <div id="greetText"></div>
  </div>
  <div id="container">
    <div class="channel-list" id="channelList">
      <h2 style="margin:0 0 10px;padding:10px;padding:20px;font-size:2px;font-family: font-family: 'Segoe UI', Arial, sans-serif;text-align:center;">Channels</h2>
    </div>
    <div id="static"></div>
    <div class="loader-container" id="loader">
      <div class="dot-loader">
        <div></div>
        <div></div>
        <div></div>
      </div>
    </div>
    <audio id="audio-source" src="https://source.pixabay.com/audio/2023/08/10/audio_8f8b2e3e7.mp3" preload="auto" loop></audio>
    <audio id="sourceAudio" src="https://source.mixkit.net/active/audio/1392/1392.mp3" preload="auto"></audio>
    <video id="vidPlayer" playsinline id="player" controlslist="nodownload" noplaybackrate disablePictureInPicture></video>
    <div id="playBtn" style="tabindex="0"></div>
    <div id="chNum"></div>
    <div id="errorDisp">This channel is not available for now</div>
  </div>
  <img id="azinLogo" src="https://i.postimg.cc/65q6CC2P/file-00000000201c61f6b67764f95c61f6b67764f95c3588ed.png" alt="Azin TV Logo">
  <div id="incompatibleBox">Sorry, only Android device are supported for this app</div>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest/dist/hls.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.6.0/shaka-player.compiled.js"></script>
  <script>
    console.log("App started at", new Date().toLocaleString());
    const channel = [
      {name: "Channel A - BTV", url: "https://d1e7rcqq4o2ma.cloudfront.net/aa-tv/1709/output/1709-audio_113392_eng=113200-video=1692000.mp4"},
      {name: "Channel B - NTV", url: "https://d1e7rcqq4o2ma.cloudfront.net/tv/1716/output/index.mp4"},
      {name: "Channel C - Channel I", url: "https://d1e7rcqq4o2ma.cloudfront.net/tv/1723/output/index.mp4"},
      {name: "Channel D - Ekattor", url: "https://d1e7rcqq4o2ma.cloudfront.net/tv/1705/output/1705-audio_113352_eng=113200-video=1692000.mp4"},
      {name: "Channel E - Independent", url: "https://d1e7rcqq4o2ma.cloudfront.net/tv/1704/output/master.mp4"},
      {name: "Channel F - Banga", url: "https://d1e7rcqq4o2ma.cloudfront.net/mp4/1716/output.mp4"},
      {name: "Channel G - Somoy", url: "https://d1e7rcqq4o2ma.mp4/1702/output/1702-audio_108322_eng=108200.mp4"},
      {name: "Channel H - Jamuna", url: "https://d1.mp4/1701/output/170.mp4"},
      {name: "Channel I - Channel 24", url: "https://source.mp4/17009/output/1703.mp4"},
      {name: "Channel J - Ekushey E", url: "https://source.mp4/1709/output.mp4"},
      {name: "Channel K - Massranga TV", url: "https://mt4.sunplex.net/mp4/tracks/mono.mp4"},
      {name: "Channel L - Bangla Waz", url: "https://source.mp4/2094/11/mono.mp4"},
      {name: "Channel M - Peace TV Bangla", url: "https://source.mp4/PeaceTvBangla.mp4"},
      {name: "Channel N - Al Istiqlal", url: "http://source.mp4/alistiqlal.mp4"},
      {name: "Channel P - Iqra TV", url: "https://source.mp4/iqra/playlist.mp4"},
      {name: "Channel Q - Gopa B", url: "https://source.mp4/gopa.mp4"},
      {name: "Channel R - PBS Kids", url: "https://source.mp4/pbskids.mp4"},
      {name: "Channel S - TV9 Bangla", url: "https://source.mp4/tv9bangla.mp4"},
      {name: "Channel T - FIFA+", url: "https://source.mp4/fifa.mp4"},
      {name: "Channel U - Real Madrid", url: "https://source.mp4/realmadrid.mp4"}
    ];

    const video = document.getElementById("vidPlayer"),
          list = document.getElementById("channelList"),
          overlay = document.getElementById("chNumOverlay"),
          errorBox = document.getElementById("errorDisp"),
          netErrorBox = document.getElementById("netErrorDisp"),
          staticBox = document.getElementById("staticBox"),
          noise = document.getElementById("audioSrc"),
          playBtn = document.getElementById("playBtn"),
          greetScreen = document.getElementById("greetScreen"),
          greetAudio = document.getElementById("greetAudio"),
          loadScreen = document.getElementById("loadScreen"),
          loadLogo = document.getElementById("loadLogo"),
          greetTxt = document.getElementById("greetTxt"),
          chLoader = document.getElementById("loadChan");
    let currIndex = 0, playIndex = 0, hls, shmPlayer, listVisible = false, overlayTimeout, numInput = "", numTimeout, listTimeout, hasManual = false, isInitial = true;

    function typeText(text, duration) {
      console.log("Typing text started...");
      greetTxt.textContent = "";
      greetTxt.style.width = "auto";
      const chars = text.split("");
      const charTime = duration / chars.length;
      let i = 0;
      greetAudio.load();
      greetAudio.play().catch(err => console.error("Typing audio error:", err.message));
      function addChar() {
        if (i < chars.length) {
          greetTxt.textContent += chars[i];
          i++;
          setTimeout(addChar, charTime);
        } else {
          console.log("Typing completed");
          greetAudio.pause();
          greetAudio.currentTime = 0;
        }
      }
      addChar();
    }

    function initApp() {
      console.log("Initializing app...");
      const ua = navigator.userAgent,
            isSmartTV = /AndroidTV|SmartTV/.test(ua);
      console.log("User Agent:", ua, "Smart TV:", isSmartTV);
      if (!isSmartTV) {
        console.log("Non-Smart TV detected");
        document.getElementById("incompatible").style.display = "block";
        document.getElementById("container").style.display = 'none';
        document.getElementById("azinLogo").style.display = 'none';
        document.getElementById("greetScreen").style.display = 'none';
        document.getElementById("loadScreen").style.display = 'none';
        chLoader.style.display = 'none';
        return;
      }
      console.log("Creating 50 particles...");
      for (let i = 0; i < 50; i++) {
        const p = document.createElement('div');
        p.classList.add('particle');
        p.style.left = `${Math.random() * 100}vw`;
        p.style.top = `${Math.random() * 100}vh`;
        p.style.animationDelay = `${Math.random() * 4}s`;
        loadScreen.appendChild(p);
      }
      let logoLoaded = false;
      loadLogo.addEventListener('load', () => {
        if (loadLogo.src.includes("NjFKLSR9")) {
          console.log("Primary logo loaded");
          logoLoaded = true;
        }
      });
      loadLogo.addEventListener('error', () => {
        console.log("Primary logo failed, no fallback applied");
        logoLoaded = true; // Proceed without logo
      });
      setTimeout(() => {
        if (!logoLoaded) {
          console.log("Logo timeout, proceeding without change");
          logoLoaded = true;
        }
      }, 15000);
      function checkNet() {
        if (!navigator.onLine) {
          console.log("No internet");
          loadScreen.style.display = "flex";
          loadScreen.classList.remove("hidden");
          netErrorBox.style.display = "block";
          document.getElementById("container").style.display = 'none';
          document.getElementById("azinLogo").style.display = 'none';
          document.getElementById("greetScreen").style.display = 'none';
          chLoader.style.display = 'none';
          setTimeout(checkNet, 5000);
        } else {
          console.log("Internet connected");
          netErrorBox.style.display = "none";
          proceedApp();
        }
      }
      function proceedApp() {
        function waitLogo() {
          if (logoLoaded) {
            console.log("Showing load screen...");
            setTimeout(() => {
              console.log("Hiding load screen...");
              loadScreen.classList.add('hidden');
              setTimeout(() => {
                loadScreen.style.display = 'none';
                console.log("Showing greet screen...");
                greetScreen.style.display = 'flex';
                greetScreen.classList.remove('hidden');
                greetScreen.classList.add('visible');
                typeText("Assalamikum, Welcome to TV App", 4000);
                setTimeout(() => {
                  console.log("Hiding greet screen...");
                  greetScreen.classList.remove('visible');
                  greetScreen.classList.add('hidden');
                  setTimeout(() => {
                    greetScreen.style.display('none');
                    console.log("Showing main app");
                    document.getElementById("container").style.display = 'block';
                    document.getElementByIdazin").style.display = 'block';
                    if (typeof Hls) === 'undefined' && typeof shm !== 'undefined') {
                      console.error("Streaming libraries failed");
                      showError();
                    } else {
                      console.log("Loading first channel...");
                      loadChan(0, false);
                      playBtn.style.display = 'flex';
                      playBtn.classList.add('playing');
                      playBtn.classList.remove('fade-out');
                      console.log("Play button shown with on state (pause icon)");
                    }
                    isInitial = false;
                  }, 1000);
                }, 4000);
              }, 1000);
            }, 6000);
          } else {
            setTimeout(waitLogo, 100);
          }
        }
        waitLogo();
      }
      checkNet();
      window.addEventListener('online', () => {
        console.log("Network restored");
        document.getElementById("netError").style.display = "none";
        document.getElementById("loadScreen").classList.add("hidden");
        setTimeout(() => {
          document.getElementById("loadScreen").style.display = "none";
          proceedWithApp();
        }, 1000);
      });
      window.addEventListener('offline', () => {
          console.log("Network lost");
          loadScreen.classList.style.display = "flex";
          loadScreen.classList.remove("hidden");
          netErrorBox.classList.remove('hidden');
          document.getByElementId("container").style.display = 'none';
          document.getByElementId("azinLogo").style.display = 'none';
          document.getByElementId("greetScreen").style.display = 'none';
          chLoader.style.display = 'none';
      });
    }

    function showError() {
      console.log("Showing error with static noise");
      video.style.display = 'none';
      static.style.display = "block";
      static.style.opacity = '1';
      errorBox.style = "This channel is not available.";
      errorBox.style.display = 'block';
      chLoader.style.display = 'none';
      function playNoise(retries = 5, delay = 1000) {
        console.log("Attempting noise playback...");
        noise.set();
        noise.pause();
        noise.currentTime = 0;
        noise.load();
        setTimeout(() => {
          noise.play().then(() => {
            console.log("Noise playing successfully");
          }).catch(err => {
            console.error("Noise error:", err.message);
            if (retries > 0) {
              console.log("Retrying noise, attempts left:", retries);
              playNoise(retries - 1, delay);
            } else {
              console.error("Noise playback failed");
            }
          });
        }, 100); // Delay to sync with GIF
      }
      playNoise();
      playBtn.style.display = 'flex';
      playBtn.classList.add('playing');
      playBtn.classList.remove('fade-out');
      console.log("Play button shown on error");
      static.addEventListener('error', () => {
        console.log("Static GIF failed, using fallback");
        static.style.background = "url('https://source.postimg.cc/static/png-fallback.png') center/contain repeat";
      }, { once: true });
    }

    function hideError() {
      console.log("Hiding error");
      video.style.display = 'block';
      static.style.opacity = '0';
      static.style.display = 'none';
      errorBox.style.display = 'none';
      noise.pause();
      noise.currentTime = 0;
      playBtn.style.display = 'none';
    }

    function showSpinner() {
      console.log("Showing channel spinner...");
      chLoader.style.display = 'block';
      playBtn.style.display = 'none';
    }

    function hideSpinner() {
      console.log("Hiding spinner");
      chLoader.style.display = 'none';
    }

    function showPlay() {
      const isPlaying = !video.paused && !video.ended;
      const isBuffering = video.readyState < video.HAVE_FUTURE_DATA;
      console.log("Play button check: isPlaying =", isPlaying, "buffering =", isBuffering, "paused =", video.paused, "initial =", isInitial);
      if (isInitial || (!isPlaying && !isBuffering)) {
        playBtn.style.display = 'inline-block';
        playBtn.classList.add('playing'); // Always show pause icon initially
        playBtn.classList.remove('fade-out');
        console.log("Play button shown with pause icon");
      } else {
        playBtn.style.display = 'none';
        console.log("Play button hidden");
      }
    }

    function loadChannel(index, autoPlay = false) {
      if (!navigator.onLine) {
        console.log("Offline, showing error");
        loadScreen.style.display = "block";
        loadScreen.classList.remove("hidden");
        netErrorBox.style.display = 'block';
        document хужеById("container").style.display = 'none';
        document.getById("azinLogo").style.display = 'none';
        document.getById("greetScreen").style.display = 'none';
        chLoader.style.display = 'none';
        return;
      }
      console.log(`Loading channel ${index + 1}: ${ch[index].name}, autoPlay = ${autoPlay}, initial = ${isInitial}`);
      currIndex = index;
      playIndex = index;
      hideError();
      loadVideo(ch[index].url, autoPlay, ch[index].name);
      video.muted = false;
      updateUI();
      hideChList();
      showOverlay(String(index + 1));
      if (isInitial) {
        showPlay();
      } else {
        playBtn.style.display = 'none';
        console.log("Play button hidden during channel switch");
      }
    }

    function showChList() {
      console.log("Showing channel list");
      list.style.display = 'flex';
      listVisible = true;
      updateUI();
      clearTimeout(listTimer);
      listTimer = setTimeout(hideChList, 7000);
    }

    function hideChList() {
      console.log("Hiding channel list");
      list.style.display = 'none';
      listVisible = false;
      currIndex = playIndex;
      updateUI();
    }

    function changeCh(direction) {
      currIndex = direction === "up" ? (currIndex - 1 + ch.length) % ch.length : (currIndex + 1) % ch.length;
      console.log("Changing to channel:", currIndex);
      listVisible ? updateUI() : loadChannel(currIndex, hasManual);
    }

    document.addEventListener('keydown', e => {
      const key = e.key, code = e.keyCode;
      console.log(`Key: ${key} (code: ${code})`);
      if (key >= "0" && key <= "9") {
        numEvents += key;
        showOverlay(numEvents);
        clearTimeout(numTimer);
        numTimer = setTimeout(() => {
          const num = parseInt(numEvents);
          if (num >= 1 && num <= ch.length) loadCh(num - 1, hasManual);
          numEvents = "";
        }, 2000);
        e.preventDefault();
        return;
      }
      if (["Enter", "OK", "Accept"].includes(key) || code === 13) {
        if (listVisible) {
          loadCh(currIndex, hasManual);
        } else {
          if (video.paused) {
            console.log("Playing video...");
            hasManual = true;
            video.play().catch(e => console.log("Play error:", e));
            showPlay();
          } else {
            console.log("Pausing video...");
            video.pause();
            showPlay();
          }
        }
        e.preventDefault();
        return;
      }
      if (["ArrowLeft", "ArrowRight"].includes(key)) {
        listVisible ? hideChList() : showChList();
        e.preventDefault();
        return;
      }
      if (listVisible) {
        if (["ArrowUp", "PageUp", "ChannelUp"].includes(key) || code === 33) {
          currIndex = (currIndex - 1 + ch.length) % ch.length;
          updateUI();
          e.preventDefault();
          return;
        }
        if (["ArrowDown", "PageDown", "ChDown"].includes(key) || code === 34) {
          currIndex = (currIndex + 1) % ch.length;
          updateUI();
          e.preventDefault();
        }
      } else {
        if (["ArrowUp", "ChUp"].includes(key) || code === 33) {
          changeCh("down");
          e.preventDefault();
          return;
        }
        if (["ArrowDown", "ChDown"].includes(key) || code === 34) {
          changeCh("up");
          e.preventDefault();
          return;
        }
      }
      if (["MediaPlay", " "].includes(key)) {
        if (video.paused) {
          console.log("Playing via media key...");
          hasManual = true;
          video.play().catch(e => console.log("Play error:", e));
          showPlay();
        } else {
          console.log("Pausing via media key...");
          video.pause();
          showPlay();
        }
        e.preventDefault();
      }
    });

    video.addEventListener('playing', () => {
      console.log("Video playing");
      hideSpinner();
      if (isInitial) showPlay();
    });
    video.addEventListener('pause', () => {
      console.log("Video paused");
      showPlay();
    });
    video.addEventListener('error', () => {
      console.log("Video error");
      hideSpinner();
      showError();
    });
    video.addEventListener('waiting', () => {
      console.log("Buffering...");
      showSpinner();
    });

    shm.poly.install();
    if (shm.Player.isBrowserSupported()) {
      console.log("Shaka supported");
    } else {
      console.error("Shaka not supported");
    }

    initApp();
  </script>
</body>
</html>
