<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart TV Live App - Enhanced Player</title>
  <link rel="stylesheet" href="https://vjs.zencdn.net/8.6.1/video-js.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      height: 100vh;
      background: black;
      color: #fff;
      font-family: 'Segoe UI', Arial, sans-serif;
      overflow: hidden;
    }
    #container {
      position: relative;
      height: 100vh;
      width: 100vw;
      display: none;
    }
    .channel-list {
      position: absolute;
      top: 0;
      left: 0;
      width: 300px;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      flex-direction: column;
      padding: 0;
      overflow-y: auto;
      z-index: 100;
    }
    .channel {
      padding: 10px;
      border: 1px solid gray;
      margin-bottom: 5px;
      background: #222;
      cursor: pointer;
    }
    .channel.active {
      background: #444;
      border-color: #fff;
    }
    #player {
      width: 100vw;
      height: 100vh;
      object-fit: fill;
      z-index: 1;
    }
    #playButton {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100px;
      height: 100px;
      background: rgba(255, 255, 255, 0.15);
      border: 2px solid #fff;
      border-radius: 50%;
      display: none;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 100;
      transition: opacity 0.5s ease;
    }
    #playButton.fade-out {
      opacity: 0;
      pointer-events: none;
    }
    #playButton::before {
      content: '';
      width: 0;
      height: 0;
      border-left: 25px solid #fff;
      border-top: 15px solid transparent;
      border-bottom: 15px solid transparent;
      margin-left: 5px;
    }
    #playButton.playing::before {
      width: 25px;
      height: 30px;
      border-left: 10px solid #fff;
      border-right: 10px solid #fff;
      border-top: none;
      border-bottom: none;
      margin-left: 0;
    }
    #channelNumberOverlay {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.7);
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 32px;
      font-weight: 700;
      z-index: 20;
      opacity: 0;
      transition: opacity 0.4s ease;
    }
    #errorBox {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #000;
      color: #fff;
      padding: 40px 60px;
      font-size: 28px;
      border: 4px solid #fff;
      border-radius: 16px;
      z-index: 100;
      display: none;
      text-align: center;
      max-width: 95vw;
    }
    #loadingScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: black;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10001;
      opacity: 1;
      transition: opacity 1s ease;
    }
    #loadingScreen.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .logo-container img {
      width: 300px;
      height: auto;
    }
    .vjs-control-bar, .vjs-cast-button, .cast-button, [class*="cast"], [id*="cast"] {
      display: none !important;
    }
  </style>
</head>
<body>
  <div id="loadingScreen">
    <div class="logo-container">
      <img src="https://i.postimg.cc/NjFKLSR9/Chat-GPT-Image-May-28-2025-11-00-54-AM.png" alt="Logo">
    </div>
  </div>
  <div id="container">
    <div class="channel-list" id="channelList">
      <h2 style="margin:0 0 10px;padding:10px;font-size:20px;text-align:center;border-bottom:1px solid gray">Channels</h2>
    </div>
    <video id="player" class="video-js" playsinline controlslist="nodownload noplaybackrate" disablePictureInPicture></video>
    <div id="playButton" tabindex="0"></div>
    <div id="channelNumberOverlay"></div>
    <div id="errorBox">This channel is not available for now</div>
  </div>
  <script src="https://vjs.zencdn.net/8.6.1/video.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.17/dist/hls.min.js"></script>
  <script>
    const channels = [
      { name: "Channel 1 - BTV", url: "https://d1e7rcqq4o2ma.cloudfront.net/bpk-tv/1709/output/1709-audio_113392_eng=113200-video=1692000.m3u8" },
      { name: "Channel 2 - ATN Bangla", url: "https://d1e7rcqq4o2ma.cloudfront.net/bpk-tv/1716/output/index.m3u8" },
      // আপনার বাকি চ্যানেল লিঙ্কগুলো এখানে যোগ করুন
    ];
    const player = videojs('player', {
      controls: false,
      autoplay: false,
      preload: 'auto',
      fluid: true
    });
    const list = document.getElementById("channelList"),
          overlay = document.getElementById("channelNumberOverlay"),
          errorBox = document.getElementById("errorBox"),
          playButton = document.getElementById("playButton"),
          loadingScreen = document.getElementById("loadingScreen");
    let currentIndex = 0, playingIndex = 0, listVisible = false, overlayTimeout, numberInput = "", numberTimeout, listTimeout, hasManuallyPlayed = false;

    function initializeApp() {
      if (!/TV|BRAVIA|AFT|SmartTV|Tizen|Web0S|NetCast|AppleTV/i.test(navigator.userAgent)) {
        alert("This app is only supported on Smart TVs");
        return;
      }
      setTimeout(() => {
        loadingScreen.classList.add('hidden');
        document.getElementById("container").style.display = 'block';
        loadChannel(0, false);
      }, 3000);
    }

    function showErrorVisual(msg) {
      errorBox.innerText = msg;
      errorBox.style.display = "block";
      player.pause();
    }

    function hideErrorVisual() {
      errorBox.style.display = "none";
    }

    channels.forEach((ch, i) => {
      const div = document.createElement("div");
      div.className = "channel";
      div.innerText = ch.name;
      div.onclick = () => loadChannel(i, hasManuallyPlayed);
      list.appendChild(div);
    });

    function updateUI() {
      document.querySelectorAll('.channel').forEach((el, i) => {
        el.classList.toggle('active', i === currentIndex);
        if (i === currentIndex && listVisible) el.scrollIntoView({ block: "nearest" });
      });
      if (listVisible) {
        clearTimeout(listTimeout);
        listTimeout = setTimeout(hideChannelList, 7000);
      }
    }

    function showOverlay(text) {
      overlay.innerText = text;
      overlay.style.opacity = '1';
      clearTimeout(overlayTimeout);
      overlayTimeout = setTimeout(() => { overlay.style.opacity = '0'; }, 2000);
    }

    function loadChannel(index, autoPlay) {
      if (!navigator.onLine) {
        showErrorVisual("No Internet Connection");
        return;
      }
      currentIndex = index;
      playingIndex = index;
      hideErrorVisual();
      const src = channels[index].url;
      if (src.endsWith('.m3u8') && Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(src);
        hls.attachMedia(player.el().querySelector('video'));
        hls.on(Hls.Events.MANIFEST_PARSED, () => {
          if (autoPlay) player.play();
          showPlayButton(autoPlay);
        });
        hls.on(Hls.Events.ERROR, (_, data) => {
          if (data.fatal) showErrorVisual("This channel is not available");
        });
      } else {
        player.src({ src: src, type: src.endsWith('.m3u8') ? 'application/x-mpegURL' : 'video/mp4' });
        player.ready(() => {
          if (autoPlay) player.play();
          showPlayButton(autoPlay);
        });
        player.on('error', () => showErrorVisual("Failed to load channel"));
      }
      updateUI();
      hideChannelList();
      showOverlay(String(index + 1));
    }

    function showChannelList() {
      list.style.display = "flex";
      listVisible = true;
      updateUI();
    }

    function hideChannelList() {
      list.style.display = "none";
      listVisible = false;
      currentIndex = playingIndex;
      updateUI();
    }

    function showPlayButton(isPlaying) {
      playButton.style.display = 'flex';
      playButton.classList.toggle('playing', isPlaying);
      playButton.classList.remove('fade-out');
      if (isPlaying) setTimeout(() => playButton.classList.add('fade-out'), 3000);
    }

    document.addEventListener('keydown', e => {
      const key = e.key;
      if (key >= "0" && key <= "9") {
        numberInput += key;
        showOverlay(numberInput);
        clearTimeout(numberTimeout);
        numberTimeout = setTimeout(() => {
          const num = parseInt(numberInput, 10);
          if (num >= 1 && num <= channels.length) loadChannel(num - 1, hasManuallyPlayed);
          numberInput = "";
        }, 2000);
        e.preventDefault();
      } else if (["Enter", "OK"].includes(key)) {
        if (listVisible) {
          loadChannel(currentIndex, hasManuallyPlayed);
        } else {
          hasManuallyPlayed = true;
          player.paused() ? player.play() : player.pause();
          showPlayButton(!player.paused());
        }
        e.preventDefault();
      } else if (["ArrowLeft", "ArrowRight"].includes(key)) {
        listVisible ? hideChannelList() : showChannelList();
        e.preventDefault();
      } else if (["ArrowUp", "ChannelUp"].includes(key)) {
        currentIndex = (currentIndex - 1 + channels.length) % channels.length;
        listVisible ? updateUI() : loadChannel(currentIndex, hasManuallyPlayed);
        e.preventDefault();
      } else if (["ArrowDown", "ChannelDown"].includes(key)) {
        currentIndex = (currentIndex + 1) % channels.length;
        listVisible ? updateUI() : loadChannel(currentIndex, hasManuallyPlayed);
        e.preventDefault();
      }
    });

    initializeApp();
  </script>
</body>
</html>
